#!/bin/bash


no_cmake() {
    echo "Cannot find CMake, required for build of userspace components"
    exit 1
}


# Check if kernel headers are there for out-of-tree build
if [ ! -d /lib/modules/`uname -r`/build ]; then
    echo "Cannot find '/lib/modules/$(uname -r)/build' directory"
    echo "Make sure headers for the running kernel are installed"
    exit 1
fi

# Make sure CMake is installed
which cmake || no_cmake

# Configure CMake for out-of-tree build
rm -rf build &> /dev/null
mkdir build || exit 1

(
cd build
cmake .. -DCMAKE_INSTALL_PREFIX=/ -DCMAKE_BUILD_TYPE=Debug
)

# Generate the Makefile (just a trivial copy)
cp Makefile.in Makefile
