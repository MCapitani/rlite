# Protocol buffer processing
protobuf_generate_cpp(CDAP_GPB_SRC CDAP_GPB_HDR CDAP.proto)

find_package(SWIG REQUIRED)
include(${SWIG_USE_FILE})
find_package(PythonLibs)
include_directories(${PYTHON_INCLUDE_PATH})
include_directories(${CMAKE_CURRENT_SOURCE_DIR})
set(CMAKE_SWIG_FLAGS "")
swig_add_module(rlite python rlite.i utils.c ker-numtables.c conf-numtables.c ctrl.c)
swig_link_libraries(rlite ${PYTHON_LIBRARIES})

# Libraries generated by the project
add_library(rlite SHARED utils.c ker-numtables.c conf-numtables.c ctrl.c)
add_library(rlite-evloop SHARED evloop.c)
add_library(rlite-cdap SHARED cdap.cpp ${CDAP_GPB_SRC} ${CDAP_GPB_HDR})
add_library(rlite-conf SHARED conf.c)

target_link_libraries(rlite ${CMAKE_THREAD_LIBS_INIT})
target_link_libraries(rlite-evloop rlite ${CMAKE_THREAD_LIBS_INIT})
target_link_libraries(rlite-cdap rlite ${PROTOBUF_LIBRARY})
target_link_libraries(rlite-conf rlite)

message(STATUS "Adding include dir ${CMAKE_CURRENT_BINARY_DIR} to rlite-cdap target")
target_include_directories(rlite-cdap PUBLIC ${CMAKE_CURRENT_BINARY_DIR})

# Executables generated by the project
add_executable(test-cdap test-cdap.cpp)

target_link_libraries(test-cdap rlite-cdap)

# Installation directives
install(TARGETS rlite rlite-evloop rlite-cdap rlite-conf DESTINATION usr/lib)
install(FILES ${CMAKE_CURRENT_BINARY_DIR}/CDAP.pb.h DESTINATION usr/include/rlite)
